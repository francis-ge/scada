<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<META HTTP-EQUIV="pragma" CONTENT="no-cache"> 
<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate"> 
<META HTTP-EQUIV="expires" CONTENT="0">

<!-- easyUI -->
<link href="jquery-easyui-1.5/themes/bootstrap/easyui.css" rel="stylesheet">
<link href="jquery-easyui-1.5/themes/icon.css" rel="stylesheet">

<style type="text/css">
	* {margin: 0; border: 0; padding: 0;}
	
	.datagrid-cell, .datagrid-cell-group, .datagrid-header-rownumber, .datagrid-cell-rownumber{
		//line-height: 50px;
		font-size: 20px;
	}
</style>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) --> 
<script src="jquery-easyui-1.5/jquery.min.js" charset="utf-8"></script>

<!-- easyUI -->
<script src="jquery-easyui-1.5/jquery.easyui.min.js" charset="utf-8"></script>
<script src="jquery-easyui-1.5/locale/easyui-lang-zh_CN.js" charset="utf-8"></script>

<title></title>
</head>

<body class="easyui-layout" fit="true">   
    <div id="north" data-options="region:'north',title:'',split:false" style="height:9%;background:#85B9FF">
    	<a href="http://www.sharpower.cn" target="_blank"><img alt="logo" src="pic/logo.png" style="height: 100%"></a>
    	<div style="position:absolute;right:50px;bottom:2px">
	    	<a id="user" href="#" style="color:#707070"></a>	
	    	<a id="logout" href="#" style="color:#008000">退出</a>
    	</div>
    </div>

    <div id="west" data-options="region:'west',title:'导航栏',split:true" style="width:200px;">
	    <div class="easyui-accordion" fit="true">
	    	<div title="风场概览" style="overflow:auto;">
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_realtimeInfo/windFarm_main.html" href="#">风场概览</a>
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_realtimeInfo/windFarm_main_table.html" href="#">风场概览(表格)</a>
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_realtimeInfo/windFarm_main_map.html" href="#">实景地图</a>
	    	</div>
	    	
	    	<div title="瞬时信息" style="overflow:auto;">
    			<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_realtimeInfo/realtime_info.html" href="#">瞬时信息</a>
	    	</div>
	    	
	    	<div title="风机曲线" style="overflow:auto;">
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_curve/realTime_curve.html" href="#">实时曲线</a>
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_curve/history_curve.html" href="#">历史曲线</a>
	    		<!-- <a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="" href="#">一年内日统计曲线</a> -->
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_curve/windFrequency_curve.html" href="#">风频图</a>
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_curve/wind_rose_curve.html" href="#">风玫瑰图</a>
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_curve/power_curve.html" href="#">风速功率图</a>
	    	</div>
	    	
	    	<div title="故障报告" style="overflow:auto;">
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_error_worning/report_errorStatisticsForOne.html" href="#">单台故障统计</a>
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_error_worning/report_worningStatisticsForOne.html" href="#">单台警告统计</a>
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_error_worning/report_errorStatistics.html" href="#">风场故障统计</a>
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_error_worning/report_worningStatistics.html" href="#">风场警告统计</a>
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_error_worning/report_errorForOneQuery.html" href="#">故障查询</a>
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_error_worning/report_worningForOneQuery.html" href="#">警告查询</a>
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_error_worning/report_currentError.html" href="#">当前故障</a>
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_error_worning/report_currentWorning.html" href="#">当前警告</a>
	    	</div>
	    	
	    	<div title="风场报表" style="overflow:auto;">
		    	<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_report/report_funState.html" href="#">机组状态变化记录</a>
		    	<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_report/report_hourForOneFun.html" href="#">单台小时报表</a>
		    	<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_report/report_hour.html" href="#">风场小时报表</a>
		    	
		    	<a class="easyui-menubutton" style="display:block;width:100%;" title="" data-options="menu:'#dayReportMenu'" href="javascript:void(0)">风场日报表</a>   
					<div class="accordionMenu" id="dayReportMenu" noline="true" style="width:150px;">   
					    <a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_report/report_day_main.html" href="#">主要信息（日报）</a> 
					    <a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_report/report_day_time.html" href="#">时间统计（日报）</a>  
					</div>
		    	<a class="easyui-menubutton" style="display:block;width:100%;" title="" data-options="menu:'#monthReportMenu'" href="javascript:void(0)">风场月报表</a>   
					<div class="accordionMenu" id="monthReportMenu" noline="true" style="width:150px;">   
					   	<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_report/report_month_main.html" href="#">主要信息（月报）</a>   
					    <a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_report/report_month_time.html" href="#">时间统计（月报）</a> 
					</div> 
		    	<a class="easyui-menubutton" style="display:block;width:100%;" title="" data-options="menu:'#yearReportMenu'" href="javascript:void(0)">风场年报表</a>   
					<div class="accordionMenu" id="yearReportMenu" noline="true" style="width:150px;">   
					   	<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_report/report_year_main.html" href="#">主要信息（年报）</a>   
					    <a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_report/report_year_time.html" href="#">时间统计（年报）</a> 
					</div>  
	    	</div>
	    	
	    	<div title="风场控制" style="overflow:auto;">
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="" href="#">功率限制</a>
	    	</div>
	    	
	    	<div title="系统管理" style="overflow:auto;">
	    		<a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_manager/fun_manager.html" href="#">风机信息管理</a>
                <a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_manager/variable_manager.html"  href="#">风机变量管理</a>
                <a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_manager/trouble_variable_manager.html" href="#">故障警告变量管理</a>
                <a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_manager/user_manager.html" href="#">用户管理</a>
                <a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_manager/current_session_manager.html" href="#">在线用户管理</a>
                <a class="easyui-linkbutton" plain="true" style="display:block;width:100%;" title="easyui_manager/user_operation_query.html" href="#">用户操作查询</a>
	    	</div>
	    </div>
    </div>   
    <div data-options="region:'center'" style="overflow:hidden;background:#eee;" border="false" >
	    <div id="tabs" class="easyui-tabs" fit="true" border="false" justified="true" pill="false">
		</div>
    </div>

    <div id="south" data-options="region:'south',title:'',split:false" style="height:60px">
    	<table id="datagrid" class="easyui-datagrid" url="/sharpower_scada/ajaxWindFarmRealTimeInfo"
			singleSelect="true" fit="true" striped="true" fitColumns="true" loadMsg="">
		</table>
    </div> 
    
    <div id="dialog" title="密码修改" modal="true" draggable="false"
		class="easyui-dialog" closed="true" style="width: 280px;">
		<form id="form" action="" method="post">
			<input type="hidden" name="user.id" value="" />
			<table>
				<tr>
					<td>用户名:</td>
					<td><input type="text" name="user.name" class="easyui-textbox"
						required="true" editable="false" validType="midLength[1,10]"
						missingMessage="用户名必填!" invalidMessage="用户名必须在1到10个字符之间!"
						value="" /></td>
				</tr>
				<tr>
					<td>密码：</td>
					<td><input id="password" type="password" name="user.password"
						class="easyui-textbox" required="true" 
						missingMessage="密码必填!" 
						validType="length[4,64]" value="" />
					</td>
				</tr>
				<tr>
					<td>再次输入密码:</td>
					<td><input id="rePassword" type="password" name="rePassword"
						class="easyui-textbox" required="true"
						missingMessage="密码必填!" value="" 
						validType="equalTo['#password']" 
						invalidMessage="两次输入密码不匹配" />
					</td>
				</tr>
				<tbody style="display: none">
					<tr>
						<td>角色:</td>
						<td><select id="plcType" name="user.role.id"
							class="easyui-combobox" required="true"
							missingMessage="角色必填!" style="width:180px;"
							url="/sharpower_scada/ajaxAllRoles" valueField="id"
							textField="name" value="" ></select>
						</td>
					</tr>
					<tr>
						<td>创建日期:</td>
						<td><input type="text" name="user.creatDate"
							class="easyui-textbox" editable="false" value=""  />
						</td>
					</tr>
					<tr>
						<td>禁用：</td>
						<td>				
							<input name="user.disabled" type="checkbox" value="true" />
						</td>
						
					</tr>
				</tbody>
				<tr align="right">
					<td colspan="2">
						<a id="submitBtn" class="easyui-linkbutton">确定</a>
						<a id="closeBtn"  class="easyui-linkbutton">关闭</a>
					</td>
				</tr>
			</table>
		</form>
	</div>
    
	
	<script type="text/javascript">
		$(function(){
			$.post('/sharpower_scada/ajaxCurrentUserName', function(data){
				$('#user').text('当前用户：['+ data.result +']');
			},'json');
			
			$('#tabs').tabs('add',{
				title : '风场概览',
				content : '<iframe frameborder=0 style=height:100%;width:100%; src=easyui_realtimeInfo/windFarm_main.html></iframe>',
				closable : true
			});
			
			$(".easyui-accordion a[plain='true'], .accordionMenu a").click(
				function(){
					var src = $(this).attr('title') + '?ran=' + Math.random();
					var title = $(this).text();
					
					if (src=="") return false;
					
					if($('.easyui-tabs').tabs('exists', title)){
						$('.easyui-tabs').tabs('select',title);
					}else{
						$('#tabs').tabs('add',{
							title : title,
							content : '<iframe frameborder=0 style=height:100%;width:100%; src=' + src + '></iframe>',
							closable : true
						})
					}
				});
				
			function formatField(value){
				return '<h1 style="font-size:50px">' + Math.round(value*100)/100 + '</h1>';
			}		

			var $loadMsg;
			
			$('#datagrid').datagrid({       
			    columns:[[    
			        {field:'runFunCount',title:'运行',width:60,align:'center',styler:function(){return 'background-color:#CCFF99;'}},    
			        {field:'standbyFunCount',title:'待机',width:60,align:'center',styler:function(){return 'background-color:#FFFF99;'}},    
			        {field:'stopFunCount',title:'停机',width:60,align:'center',styler:function(){return 'background-color:#FF6666;'}},    
			        {field:'serviceFunCount',title:'维护',width:60,align:'center',styler:function(){return 'background-color:#CCCCFF;'}},    
			        {field:'communicationFailureFunCount',title:'通信中断',width:60,align:'center',styler:function(){return 'background-color:#99CCFF;'}},    
			        {field:'errorFunCount',title:'故障',width:60,align:'center',styler:function(){return 'background-color:#FF0000;'}},    
			        {field:'power',title:'有功功率(kW)',width:150,align:'center'},    
			        {field:'reactivePower',title:'无功功率(kVar)',width:150,align:'center'},    
			        {field:'maxPower',title:'最大功率(kW)',width:150,align:'center'},    
			        {field:'minPower',title:'最小功率(kW)',width:150,align:'center'},    
			        {field:'averagePower',title:'平均功率',width:150,align:'center'},    
			        {field:'maxWindSpeed',title:'最大风速(m/s)',width:150,align:'center'},    
			        {field:'minWindSpeed',title:'最小风速(m/s)',width:150,align:'center'},    
			        {field:'averageWindSpeed',title:'平均风速(m/s)',width:150,align:'center'},    
			        {field:'energy',title:'本日发电量(KWh)',width:150,align:'center'},    
			        {field:'energyCounter',title:'累计发电量(kWh)',width:220,align:'center'}    
			    ]],
			    rowStyler: function(index,row){
		    			return 'height:30px;font-weight:900;';
			    	},
				onLoadSuccess:function(){
						if($loadMsg){
							$.messager.progress('close');
							$loadMsg = undefined; 		
						}
					 },
				onLoadError:function(){
					 if(!$loadMsg){
						 $loadMsg = $.messager.progress({
							 text:'与SCADA服务器连接已断开，正在重连……'
						 }); 
					 }
				 }
			    
			}); 
			
			setInterval(
				function(){
					$('#datagrid').datagrid('load');
				}, 		
				1000 
			);
			
			$('#user').click(function(){
				$.post('/sharpower_scada/ajaxCurrentUser', function(data){
					$('#form').form('reset');
					$('#form').form('load',{'user.id':null});
					
					$('#form').form('load', {'user.id':data.id,
						'user.name':data.name,
						'user.password':data.password,
						'rePassword':data.password,
						'user.role.id':data.role.id,
						'user.creatDate':data.creatDate,
						'user.disabled':data.disabled});
					},'json');		
				
					$('#dialog').dialog('open');
			});
			
			$('#submitBtn').click(function(){
				$.messager.progress();	// 显示进度条
				$('#form').form('submit', {
					url:'ajaxAddOrUpdateUser',
					onSubmit: function(){
						var isValid = $(this).form('validate');
						if (!isValid){
							$.messager.progress('close');	// 如果表单是无效的则隐藏进度条
						}
						return isValid;	// 返回false终止表单提交
					},
					success: function(info){
						$.messager.progress('close');	// 如果提交成功则隐藏进度条
						info = eval("("+info+")");
						$.messager.show({title:'我的消息',msg:info.result,showType:'slide'});
						
						if(info.result=="操作成功！"){
							window.location.href='/sharpower_scada/logout';
						}
					}
				});
				
			});
			
			$('#logout').click(function(){
				$.messager.confirm('确认对话框','您想要退出系统吗？',function(r){
					if(r){
						window.location.href='/sharpower_scada/logout';
					}
				});
				
			});

			/**
			 * 关闭窗口方法
			 */
			$('#closeBtn').click(function(){
				$('#dialog').dialog('close');
			});
			
			
			/**
			 * easyui validatebox验证扩展 验证两次输入密码的一致性
			 */
			$.extend($.fn.validatebox.defaults.rules, {  
			    /*必须和某个字段相等*/
			    equalTo: {
			        validator:function(value,param){
			            return $(param[0]).val() == value;
			        },
					message:'字段不匹配'
			    }
			});

				/*
				$(window).resize(function(){
					$('#north').panel('resize',{
						height:  $(window).height()*0.1
					});
					
					$('#south').panel('resize',{
						height:  $(window).height()*0.15
					});
					
				});
			*/
		})
	</script>
  
</body>  

</html>